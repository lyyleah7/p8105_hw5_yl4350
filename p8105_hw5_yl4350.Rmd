---
title: "Homework 5"
author: "Yiyang LIU"
date: "2019/11/6"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(rvest)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1
```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

# write a function

fill = function(x) {
   if (is.numeric(x)) {
    a = mean(x, na.rm = TRUE)
    x = replace_na(x, a)
  }else if (is.character(x)) {
    x = replace_na(x, "virginica")
  }
   x
}

# apply the function to columns of dataset

iris_fill = map_df(.x = iris_with_missing, ~ fill(.x))

iris_fill
```


# Problem 2 
* Start with a dataframe containing all file names
```{r}
filename = tibble(file_name = list.files("./data"))
```

* Iterate over file names and read in data for each subject using `purrr::map` and saving the result as a new variable in the dataframe

```{r}
path = vector("list", length = 20)

for (i in 1:20) {
  path[i] = str_c("./data/", filename[i,1])
}

data = map(path, read_csv)

df = 
  filename %>% 
  mutate(data = data)%>% 
  unnest()
```

* Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
df_clean =
  df %>%
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  mutate(
    subject_id = str_remove(subject_id, pattern = ".csv"),
    arm = str_replace(arm, "con", "control"),
    arm = str_replace(arm, "exp", "experimental")
  ) %>% 
  pivot_longer(
    3:10,
    names_to = "week",
    names_prefix = "week_"
  ) %>% 
  mutate(
    arm = as.factor(arm),
    subject_id = as.factor(subject_id),
    week = as.factor(week)
  )

```

* Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups

```{r}
plot =
  df_clean %>% 
  group_by(week, arm, subject_id) %>% 
  ggplot(aes(x = week, y = value, color = subject_id))+
  geom_line(aes(group = subject_id))+
  facet_grid(.~arm)+
  labs(title = "Observations on each subject over time")

plot
```

The values in control group is almost consistant over time but the values in experimental group have an overall increasing trend within 8 weeks.

# Problem 3

```{r}

```

